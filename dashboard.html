<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - JOMPO FarmLink</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="app.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-green-50">

  <!-- NAVBAR -->
  <nav class="bg-green-700 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">JOMPO FarmLink</h1>
    <div id="authLinks" class="flex items-center gap-2"></div>
  </nav>

  <!-- MAIN DASHBOARD CONTAINER -->
  <div class="p-4 max-w-7xl mx-auto">

    <!-- SEARCH & FILTER -->
    <div class="mb-6 flex flex-col sm:flex-row gap-3 items-center justify-between">
      <input type="text" id="searchProducts" placeholder="Search products or services..." class="border rounded px-3 py-2 flex-1">
      <select id="filterCategory" class="border rounded px-3 py-2">
        <option value="">All Categories</option>
        <option value="cereals">Cereals</option>
        <option value="vegetables">Vegetables</option>
        <option value="onions">Onions</option>
        <option value="services">Services</option>
      </select>
    </div>

    <!-- ADD LISTING FORM -->
    <div class="bg-white p-4 rounded shadow mb-6">
      <h2 class="font-bold text-green-700 mb-3">Add Product/Service</h2>
      <form id="addListingForm" class="flex flex-col gap-3">
        <input type="text" id="productName" placeholder="Product/Service Name" class="border px-3 py-2 rounded w-full" required>
        <select id="category" class="border px-3 py-2 rounded w-full" required>
          <option value="">Select Category</option>
          <option value="cereals">Cereals</option>
          <option value="vegetables">Vegetables</option>
          <option value="onions">Onions</option>
          <option value="services">Services</option>
        </select>
        <input type="number" id="quantity" placeholder="Quantity (kg)" class="border px-3 py-2 rounded w-full">
        <input type="number" id="price" placeholder="Price (KSh)" class="border px-3 py-2 rounded w-full" required>
        <input type="text" id="locationListing" placeholder="Location" class="border px-3 py-2 rounded w-full" required>
        <input type="file" id="listingImage" class="border rounded px-3 py-2 w-full">
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded">Add Listing</button>
      </form>
    </div>

    <!-- LISTINGS GRID -->
    <h2 class="font-bold text-green-700 mb-3">Your Products & Services</h2>
    <div id="listingsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>

    <!-- FARM RECORDS -->
    <div class="bg-white p-4 rounded shadow mt-6">
      <h2 class="font-bold text-green-700 mb-3">Farm Records</h2>
      <form id="farmRecordForm" class="flex flex-col gap-2">
        <input type="text" id="cropName" placeholder="Crop Name" class="border px-3 py-2 rounded" required>
        <input type="number" id="harvestQty" placeholder="Harvest Quantity (kg)" class="border px-3 py-2 rounded" required>
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded">Add Record</button>
      </form>
      <ul id="recordsList" class="mt-2 list-disc pl-5"></ul>
    </div>

    <!-- COMMUNITY -->
    <div class="bg-white p-4 rounded shadow mt-6">
      <h2 class="font-bold text-green-700 mb-3">Community</h2>
      <form id="communityForm" class="flex flex-col gap-2">
        <input type="text" id="userName" placeholder="Your Name" class="border px-3 py-2 rounded" required>
        <textarea id="message" placeholder="Write a message..." class="border px-3 py-2 rounded" required></textarea>
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded">Post</button>
      </form>
      <ul id="communityPosts" class="mt-2 list-disc pl-5"></ul>
    </div>

    <!-- SUPPORT -->
    <div class="bg-white p-4 rounded shadow mt-6">
      <h2 class="font-bold text-green-700 mb-3">Support</h2>
      <form id="supportForm" class="flex flex-col gap-2">
        <input type="text" placeholder="Your Name" class="border px-3 py-2 rounded" required>
        <textarea placeholder="Your message" class="border px-3 py-2 rounded" required></textarea>
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded">Send</button>
      </form>
      <p id="supportResponse" class="mt-2 text-green-600"></p>
    </div>

  </div>

  <!-- AI CHATBOT -->
  <div id="chatbotBubble" class="fixed bottom-5 right-5 bg-green-700 p-3 shadow-lg cursor-pointer">
    <img src="message-icon.svg" alt="Chat" class="w-10 h-10">
  </div>
  <div id="chatbotWindow" class="fixed bottom-20 right-5 w-80 h-96 bg-white border shadow-lg rounded flex flex-col hidden">
    <div class="bg-green-700 text-white p-3 flex justify-between items-center rounded-t">
      <span>JOMPO Assistant</span>
      <button id="chatbotClose">✖</button>
    </div>
    <div id="chatbotMessages" class="flex-1 p-3 overflow-y-auto"></div>
    <div class="p-3 flex gap-2">
      <input type="text" id="chatbotText" class="border px-3 py-2 rounded flex-1" placeholder="Type your message...">
      <button id="sendChat" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded">Send</button>
    </div>
  </div>
<!-- Chatbot Bubble -->
<div id="chatbotBubble" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-3 cursor-pointer shadow-lg flex items-center space-x-2 rounded-xl z-50 hover:bg-green-700">
  <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24"><path d="M12 3C7 3 3 6.6 3 11c0 2.1.8 4 2.2 5.5L3 21l4.5-2.2c1.5 1.4 3.4 2.2 5.5 2.2 5 0 9-3.6 9-8s-4-8-9-8z"></path></svg>
  <span class="font-medium">Chat</span>
</div>

<!-- Chatbot Window -->
<div id="chatbotWindow" class="hidden fixed bottom-20 right-4 w-80 max-w-sm bg-white border shadow-lg rounded-lg z-50 flex flex-col">
  <div class="bg-green-600 text-white p-3 flex justify-between items-center rounded-t-lg">
    <span>JOMPO AI</span>
    <button id="chatbotClose" class="text-white font-bold">×</button>
  </div>
  <div id="chatbotMessages" class="p-3 h-60 overflow-y-auto space-y-2 text-sm"></div>
  <div class="p-3 border-t flex space-x-2">
    <input type="text" id="chatbotText" placeholder="Ask me..." class="flex-1 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-green-500">
    <button id="sendChat" class="bg-green-500 hover:bg-green-600 text-white px-3 rounded transition">Send</button>
  </div>
</div>

<script>
const bubble = document.getElementById('chatbotBubble');
const windowChat = document.getElementById('chatbotWindow');
const closeChat = document.getElementById('chatbotClose');
const sendChat = document.getElementById('sendChat');
const chatMessages = document.getElementById('chatbotMessages');
const chatInput = document.getElementById('chatbotText');

bubble.addEventListener('click', () => windowChat.classList.toggle('hidden'));
closeChat.addEventListener('click', () => windowChat.classList.add('hidden'));

sendChat.addEventListener('click', () => {
  const msg = chatInput.value.trim();
  if(!msg) return;
  const li = document.createElement('div');
  li.className = 'bg-green-100 p-2 rounded self-end';
  li.textContent = msg;
  chatMessages.appendChild(li);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  chatInput.value = '';

  // Dummy AI response
  setTimeout(() => {
    const reply = document.createElement('div');
    reply.className = 'bg-gray-100 p-2 rounded self-start';
    if(msg.toLowerCase().includes('weather')) reply.textContent = 'Today: Sunny, 28°C. Great for farming!';
    else reply.textContent = 'I can help you with smart farming tips, solar products, and services.';
    chatMessages.appendChild(reply);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }, 800);
});

chatInput.addEventListener('keypress', e => { if(e.key==='Enter'){sendChat.click();}});
</script>

</body>
</html>
