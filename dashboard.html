<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JOMPO Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="app.js" defer></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <!-- NAVBAR -->
  <nav class="bg-green-700 text-white p-4 flex justify-between items-center">
    <a href="dashboard.html" class="font-bold text-xl">JOMPO Dashboard</a>
    <div id="authLinks"></div>
  </nav>

  <main class="p-4 max-w-6xl mx-auto space-y-8">

    <!-- WELCOME -->
    <div>
      <h2 id="welcomeMessage" class="text-2xl font-bold mb-2"></h2>
      <p id="roleMessage" class="text-green-800 font-semibold"></p>
    </div>

    <!-- LISTINGS -->
    <section class="bg-white p-4 rounded shadow space-y-4">
      <h2 class="font-bold text-xl text-green-800 mb-2">Add New Listing</h2>
      <form id="addListingForm" class="space-y-2">
        <input id="productName" type="text" placeholder="Product/Service Name" class="w-full p-2 border rounded"/>
        <select id="category" class="w-full p-2 border rounded">
          <option value="product">Product</option>
          <option value="service">Service</option>
        </select>
        <input id="quantity" type="number" placeholder="Quantity (kg)" class="w-full p-2 border rounded"/>
        <input id="price" type="number" placeholder="Price (KES)" class="w-full p-2 border rounded"/>
        <input id="locationListing" type="text" placeholder="Location" class="w-full p-2 border rounded"/>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded">Add Listing</button>
      </form>

      <h3 class="font-bold text-lg text-green-700 mt-4">Your Listings</h3>
      <div id="listingsContainer" class="space-y-2"></div>
    </section>

    <!-- FARM RECORDS -->
    <section class="bg-white p-4 rounded shadow space-y-4">
      <h2 class="font-bold text-xl text-green-800 mb-2">Farm Records</h2>
      <form id="farmRecordForm" class="space-y-2">
        <input id="cropName" type="text" placeholder="Crop Name" class="w-full p-2 border rounded"/>
        <input id="harvestQty" type="number" placeholder="Harvest Quantity (kg)" class="w-full p-2 border rounded"/>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded">Add Record</button>
      </form>
      <ul id="recordsList" class="list-disc pl-6"></ul>
    </section>

    <!-- MARKET ACCESS -->
    <section class="bg-white p-4 rounded shadow space-y-4">
      <h2 class="font-bold text-xl text-green-800 mb-2">Market Access</h2>
      <form id="marketForm" class="space-y-2">
        <input id="productNameMarket" type="text" placeholder="Product Name" class="w-full p-2 border rounded"/>
        <input id="priceMarket" type="number" placeholder="Price (KES/kg)" class="w-full p-2 border rounded"/>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded">Add to Market</button>
      </form>
      <ul id="marketList" class="list-disc pl-6"></ul>
    </section>

    <!-- COMMUNITY POSTS -->
    <section class="bg-white p-4 rounded shadow space-y-4">
      <h2 class="font-bold text-xl text-green-800 mb-2">Community Posts</h2>
      <form id="communityForm" class="space-y-2">
        <input id="userName" type="text" placeholder="Your Name" class="w-full p-2 border rounded"/>
        <textarea id="message" placeholder="Write a message..." class="w-full p-2 border rounded"></textarea>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded">Post Message</button>
      </form>
      <ul id="communityPosts" class="list-disc pl-6"></ul>
    </section>

    <!-- SUPPORT FORM -->
    <section class="bg-white p-4 rounded shadow space-y-4">
      <h2 class="font-bold text-xl text-green-800 mb-2">Support</h2>
      <form id="supportForm" class="space-y-2">
        <textarea id="supportMessage" placeholder="Write your message..." class="w-full p-2 border rounded"></textarea>
        <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded">Send</button>
      </form>
      <p id="supportResponse" class="text-green-700 font-semibold"></p>
    </section>

  </main>

  <!-- ================== CHATBOT BUBBLE ================== -->
  <div id="chatbotBubble">
    <div id="chatbotBtn">
      <img src="https://img.icons8.com/color/48/000000/chat--v1.png" alt="Chat" class="w-8 h-8"/>
    </div>
    <div id="chatWindow">
      <div id="chatHeaderBubble">JOMPO AI Chat</div>
      <div id="chatBodyBubble"></div>
      <div id="chatInputContainer">
        <input id="chatInputBubble" type="text" placeholder="Type a message..." />
        <button id="chatSendBubble">Send</button>
      </div>
    </div>
  </div>

  <style>
    #chatbotBubble { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
    #chatbotBtn { background-color: #16a34a; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    #chatWindow { width: 300px; max-width: 90%; height: 400px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: none; flex-direction: column; overflow: hidden; margin-bottom: 10px; }
    #chatHeaderBubble { background: #16a34a; color: white; font-weight: bold; padding: 12px; cursor: pointer; }
    #chatBodyBubble { flex: 1; padding: 8px; overflow-y: auto; background: #f0fdf4; }
    #chatInputContainer { display: flex; border-top: 1px solid #ccc; }
    #chatInputBubble { flex: 1; border: none; padding: 8px; }
    #chatSendBubble { background: #16a34a; color: white; border: none; padding: 0 16px; cursor: pointer; }
    .userMsg { text-align: right; margin: 4px; }
    .botMsg { text-align: left; margin: 4px; }
  </style>

  <script>
    const chatbotBtn = document.getElementById('chatbotBtn');
    const chatWindow = document.getElementById('chatWindow');
    const chatHeaderBubble = document.getElementById('chatHeaderBubble');
    const chatBodyBubble = document.getElementById('chatBodyBubble');
    const chatInputBubble = document.getElementById('chatInputBubble');
    const chatSendBubble = document.getElementById('chatSendBubble');

    chatbotBtn.addEventListener('click', () => {
      chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex';
    });

    chatHeaderBubble.addEventListener('click', () => {
      chatWindow.style.display = 'none';
    });

    function sendChatMessage() {
      const msg = chatInputBubble.value.trim();
      if (!msg) return;
      const userDiv = document.createElement('div');
      userDiv.classList.add('userMsg');
      userDiv.innerHTML = `<strong>You:</strong> ${msg}`;
      chatBodyBubble.appendChild(userDiv);

      chatInputBubble.value = '';
      chatBodyBubble.scrollTop = chatBodyBubble.scrollHeight;

      const botDiv = document.createElement('div');
      botDiv.classList.add('botMsg');
      botDiv.innerHTML = `<strong>AI:</strong> Typing...`;
      chatBodyBubble.appendChild(botDiv);
      chatBodyBubble.scrollTop = chatBodyBubble.scrollHeight;

      setTimeout(() => {
        botDiv.innerHTML = `<strong>AI:</strong> Hello! You said: "${msg}"`;
        chatBodyBubble.scrollTop = chatBodyBubble.scrollHeight;
      }, 1000);
    }

    chatSendBubble.addEventListener('click', sendChatMessage);
    chatInputBubble.addEventListener('keypress', e => { if (e.key === 'Enter') sendChatMessage(); });
  </script>

</body>
</html>
